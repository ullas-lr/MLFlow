"use strict";var d2c,__extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,a){function o(t){try{s(i.next(t))}catch(t){a(t)}}function c(t){try{s(i.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,c)}s((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(t){!function(t){var e=function(){function t(t){this.__next=t,this._isComplete=!1,this._next=t}return t.prototype.setNext=function(t){this._next=t},t.prototype.isComplete=function(){return this._isComplete},t.prototype.complete=function(t){var e;this._isComplete=!0,null===(e=this._next)||void 0===e||e.start(t)},t}();t.Task=e}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(e){var n;e.ACTIVITY_LOG_URL="https://act.hera.d2c.ne.jp/v1/activity";var i=function(){return function(t,e,n,i,r){this.logType=t,this.activityLogId=e,this.domain=window.location.hostname,this.referrer=document.referrer,this.userAgent=window.navigator.userAgent,this.uach=n?JSON.parse(n):JSON.parse("{}"),this.startStayTime=Math.floor(i),this.sendTime=Math.floor(Date.now()/1e3),this.scrollY=Math.floor(window.scrollY),this.scrollHeight=Math.floor(document.body.scrollHeight),this.innerHeight=Math.floor(window.innerHeight),this.scrollX=Math.floor(window.scrollX),this.scrollWidth=Math.floor(document.body.scrollWidth),this.innerWidth=Math.floor(window.innerWidth),this.url=document.location.origin+document.location.pathname,this.ncid=r}}(),r=function(){function n(){}return n.prototype.createActivityLogData=function(t,e){var n=new i(e,t.activityLogId,t.getUACHString(),t.loggingStart,this.getNidanCookieId());return JSON.stringify(n)},n.prototype.isValidParameters=function(t){return"string"==typeof t&&""!==t},n.getActivityLogId=function(){return t.nidan.ActivityLogManager.getActivityLogId()},n.prototype.getNidanCookieId=function(){var e=new t.nidan.Environment,n=localStorage.getItem(e.cookieIDStorageKey);return"string"==typeof n?n:""},n.prototype.sendLog=function(t,n){var i=this.createActivityLogData(t,n);navigator.sendBeacon(e.ACTIVITY_LOG_URL,i)},n.prototype.createLoggingFunction=function(t){var e=this;return function(n){if(e.isValidParameters(n)){var i=n;e.sendLog(t,i)}}},n}();e.ActivityLogManager=r;var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.start=function(e){if(e.compleatActivity)this.complete(e);else{var i=new r;e.loggingStart=Date.now()/1e3,e.activityLogId=r.getActivityLogId(),n=i.createLoggingFunction(e),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&n("pageExit")}),t.nidan.removeAllLogEvent(),e.compleatActivity=!0,this.complete(e)}},i}(e.Task);e.ActivityLogTask=a}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.getCurrentClickID=function(){var t=new URLSearchParams(window.location.search);return 1==t.getAll(n.clickParameterKey).length&&t.get(n.clickParameterKey)||""},n.prototype.isAnalytics=function(){var t=new URLSearchParams(window.location.search);return 1==t.getAll(n.isAnalyticsKey).length&&t.get(n.isAnalyticsKey)==n.isAnalyticsValue},n.prototype.start=function(e){var i=this;if(this.isAnalytics()){t.hera.ar||(t.hera.ar=function(t){}),t.hera.ar=function(t){e.currentClickID=t,i.complete(e)};var r=document.createElement("script"),a=new URL(n.analyticsClickIDUrl);return a.search=new URLSearchParams(window.location.search).toString(),a.searchParams.append("callback","d2c.hera.ar"),r.src=a.toString(),void document.head.appendChild(r)}e.currentClickID=this.getCurrentClickID(),this.complete(e)},n.isAnalyticsKey="dad_mt",n.isAnalyticsValue="1",n.analyticsClickIDUrl="https://dcmad.jp/analytics/meas/d",n.clickParameterKey="dadcid",n}(e.Task);e.ClickIDSyncTask=n}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(){function t(){this.nidanId="",this.dadUid="",this.uach=null,this.browserId="",this.latestClickID="",this.currentClickID="",this.activityLogId="",this.loggingStart=0,this.completeUACH=!1,this.completeIdTask=!1,this.compleatActivity=!1,this.uachString=null}return t.prototype.getUACHString=function(){return null!==this.uachString?this.uachString:null===this.uach?(this.uachString="",this.uachString):(this.uachString=JSON.stringify(this.uach),this.uachString)},t}();t.HeraContext=e}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(){function t(){this._scheme="https:",this._preRequestPath="/id/nidan/pre",this._receiveRequestPath="/id/nidan/receiver",this._activityLogPath="/activity",this._accessLogPath="/access",this._storageKey="__nidan_id",this._cookieIDStorageKey="__nidan_cookie_id",this._paramKey="__did__",this._dadSyncUrl="https://nidan.addlv.smt.docomo.ne.jp/id/daisy/sync",this._nidanIDRequiredLength=80,this._notifyCallbackVersion="2";var t=window;if(t._d2c_nidan_option&&"object"==typeof t._d2c_nidan_option){var e=t._d2c_nidan_option,n=e.scheme;n&&("https:"!==n&&"http:"!==n||(this._scheme=n));var i=e.preRequestPath;i&&(this._preRequestPath=i);var r=e.storageKey;r&&(this._storageKey=r);var a=e.dadSyncUrl;a&&(this._dadSyncUrl=a)}}return Object.defineProperty(t.prototype,"scheme",{get:function(){return this._scheme+"//"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preRequestPath",{get:function(){return this._preRequestPath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"receiveRequestPath",{get:function(){return this._receiveRequestPath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activityLogPath",{get:function(){return this._activityLogPath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"accessLogPath",{get:function(){return this._accessLogPath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storageKey",{get:function(){return this._storageKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cookieIDStorageKey",{get:function(){return this._cookieIDStorageKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paramKey",{get:function(){return this._paramKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dadSyncURL",{get:function(){return this._dadSyncUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nidanIDRequiredLength",{get:function(){return this._nidanIDRequiredLength},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"notifyCallbackVersion",{get:function(){return this._notifyCallbackVersion},enumerable:!1,configurable:!0}),t}();t.Environment=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.start=function(t){this.setReceiverFunc(t),this.addRequest(t,"ds")},n.prototype.addRequest=function(e,n){var i=document.createElement("script"),r=new t.nidan.Environment,a=new URL(r.dadSyncURL);a.searchParams.append("callback","d2c.nidan."+n),a.searchParams.append("origin",window.location.origin),a.searchParams.append("domain",window.location.hostname);var o=e.activityLogId||t.hera.ActivityLogManager.getActivityLogId();a.searchParams.append("activityLogId",o),a.searchParams.append("referrer",document.referrer),i.src=a.toString(),document.head.appendChild(i)},n.prototype.setReceiverFunc=function(e){var n=this;t.nidan.ds=function(t){t&&(e.dadUid=t),e.nidanId="",e.completeIdTask=!0,n.complete(e)}},n}(e.Task);e.GetDaisyIdTask=n}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(t){!function(t){t.getRandomString=function(t){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=e.length,i="",r=0;r<t;r++)i+=e[Math.floor(Math.random()*n)];return i},t.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}}(t.util||(t.util={}))}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(){function t(t){this._isComplete=!1,this._next=t}return t.prototype.setNext=function(t){this._next=t},t.prototype.isComplete=function(){return this._isComplete},t.prototype.complete=function(t){var e;this._isComplete=!0,null===(e=this._next)||void 0===e||e.start(t)},t}();t.Task=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(){return function(t,e,n){this.activityLogId=t,this.origin=e,this.domain=window.location.hostname,this.referrer=document.referrer,this.nidanId=n}}(),n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.createAccessLogData=function(t){var n=new e(t.activityLogId,t.requestOrigin,t.nidanId);return JSON.stringify(n)},n.prototype.sendLog=function(t){var e=this.createAccessLogData(t);navigator.sendBeacon(t.getAccessLogURL(),e)},n.prototype.start=function(t){t.compleatSendAccessLog?this.complete(t):(this.sendLog(t),this.complete(t))},n}(t.Task);t.AccessLogTask=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(){function e(){this.nidanId="",this.daisyId="",this.nidanCookieId="",this.activityLogId="",this.loggingStart=0,this.completeDaisySync=!1,this.requestedDaisySync=!1,this.completeNidanSync=!1,this.compleatActivity=!1,this.compleatSendAccessLog=!1,this.environment=new t.Environment,this.nidanDomain="",this.notifyCallbacksForNidanID=[],this.notifyCallbacksForNidanAndDadUID=[],this.requestOrigin="",this.nidanDomain=t.domain.replace("/",""),this.requestOrigin=window.location.origin}return e.prototype.getPreURL=function(){return this.environment.scheme+this.nidanDomain+this.environment.preRequestPath},e.prototype.getReceiverURL=function(){return this.environment.scheme+this.nidanDomain+this.environment.receiveRequestPath},e.prototype.getActivityLogURL=function(){return this.environment.scheme+this.nidanDomain+this.environment.activityLogPath},e.prototype.getAccessLogURL=function(){return this.environment.scheme+this.nidanDomain+this.environment.accessLogPath},e}();t.NidanContext=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(t){for(;t.notifyCallbacksForNidanAndDadUID.length>0;){t.notifyCallbacksForNidanAndDadUID.pop()(t.nidanId,t.daisyId)}this.complete(t)},e}(t.Task);t.DadUIDNotifyTask=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.start=function(t){this.setReceiverFunc(t),this.addRequest(t,"ds")},n.prototype.addRequest=function(t,e){var n=document.createElement("script"),i=new URL(t.environment.dadSyncURL);i.searchParams.append("callback","d2c.nidan."+e),i.searchParams.append("origin",t.requestOrigin),i.searchParams.append("domain",window.location.hostname),i.searchParams.append("referrer",document.referrer),""!==t.nidanCookieId&&i.searchParams.append("ncid",t.nidanCookieId),n.src=i.toString(),document.head.appendChild(n)},n.prototype.setReceiverFunc=function(e){var n=this;t.nidan.ds=function(t){t&&(e.daisyId=t),e.completeDaisySync=!0,n.complete(e)}},n}(e.Task);e.DadUIDSyncTask=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.start=function(t){var e=this.getNidanCookieId(t);""!==e&&(t.nidanCookieId=e);var n=this.getNidanId(t);if(""!==n){for(t.nidanId=n,t.completeNidanSync=!0;t.notifyCallbacksForNidanID.length>0;){t.notifyCallbacksForNidanID.pop()(t.nidanId,t.daisyId)}this.complete(t)}else{t.compleatSendAccessLog=!0;this.setReceiverFunc(t),this.addPreRequest(t,"ns")}},n.prototype.addPreRequest=function(t,e){this.addRequest(t.getPreURL(),t,e)},n.prototype.addReceiverRequest=function(t,e){this.addRequest(t.getReceiverURL(),t,e)},n.prototype.addRequest=function(t,e,n){var i,r=document.createElement("script"),a=new URL(t);a.searchParams.append("callback","d2c.nidan."+n),a.searchParams.append("origin",e.requestOrigin),a.searchParams.append("domain",window.location.hostname),a.searchParams.append("referrer",document.referrer),a.searchParams.append("nv",e.environment.notifyCallbackVersion),""!==e.nidanId&&a.searchParams.append("nidanid",e.nidanId),""!==e.nidanCookieId&&a.searchParams.append("ncid",e.nidanCookieId);var o=null===(i=navigator.connection)||void 0===i?void 0:i.type;o&&a.searchParams.append("nw",o),r.src=a.toString(),document.head.appendChild(r)},n.prototype.setReceiverFunc=function(e){var n=this;t.nidan.ns=function(t){"string"==typeof t&&""!==t?(e.nidanId=t,localStorage.setItem(e.environment.storageKey,t)):t&&("n"in t&&"string"==typeof t.n&&""!==t.n&&(e.nidanId=t.n,localStorage.setItem(e.environment.storageKey,t.n)),"c"in t&&"string"==typeof t.c&&""!==t.c&&(e.nidanCookieId=t.c,localStorage.setItem(e.environment.cookieIDStorageKey,t.c))),e.completeNidanSync=!0;for(;e.notifyCallbacksForNidanID.length>0;){e.notifyCallbacksForNidanID.pop()(e.nidanId,e.daisyId)}n.complete(e),""!==e.nidanId&&n.publicationCookieDeleteRequest(e)}},n.prototype.publicationCookieDeleteRequest=function(e){t.nidan.pd=function(){},this.addReceiverRequest(e,"pd")},n.prototype.getNidanId=function(t){var e="",n=localStorage.getItem(t.environment.storageKey);"string"==typeof n&&""!==n&&(e=n);var i=window.location.search;if(0===i.length)return e;var r=[];return i.slice(1).split("&").forEach(function(e){var n=e.split("=");2===n.length&&n[0]===t.environment.paramKey&&""!==n[1]&&r.push(n[1])}),1===r.length?(e!==r[0]&&localStorage.setItem(t.environment.storageKey,r[0]),r[0]):e},n.prototype.getNidanCookieId=function(t){var e=localStorage.getItem(t.environment.cookieIDStorageKey);return"string"==typeof e?e:""},n}(e.Task);e.NidanSyncTask=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(t){t.completeNidanSync&&t.completeDaisySync&&this.complete(t)},e}(t.Task);t.WaitTask=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(e){var n;e.removers=t.nidan.removers||[],e.removeAllLogEvent=function(){for(;;){var t=e.removers.shift();if(!t)break;t()}};var i=function(){return function(t,e,n,i,r){this.logType=t,this.activityLogId=e,this.origin=n,this.domain=window.location.hostname,this.referrer=document.referrer,this.startStayTime=Math.floor(i),this.sendTime=Math.floor(Date.now()/1e3),this.scrollY=Math.floor(window.scrollY),this.scrollHeight=Math.floor(document.body.scrollHeight),this.innerHeight=Math.floor(window.innerHeight),this.scrollX=Math.floor(window.scrollX),this.scrollWidth=Math.floor(document.body.scrollWidth),this.innerWidth=Math.floor(window.innerWidth),this.ncid=r}}(),r=function(){function t(){}return t.prototype.createActivityLogData=function(t,e){var n=new i(e,t.activityLogId,t.requestOrigin,t.loggingStart,t.nidanCookieId);return JSON.stringify(n)},t.prototype.isValidParameters=function(t){return"string"==typeof t&&""!==t},t.getActivityLogId=function(){if(t.activityLogId)return t.activityLogId;var n=e.util.getRandomString(20);return t.activityLogId=n,n},t.prototype.sendLog=function(t,e){var n=this.createActivityLogData(t,e);navigator.sendBeacon(t.getActivityLogURL(),n)},t.prototype.createLoggingFunction=function(t){var e=this;return function(n){if(e.isValidParameters(n)){var i=n;e.sendLog(t,i)}}},t.activityLogId=null,t}();e.ActivityLogManager=r;var a=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.start=function(t){if(t.compleatActivity)this.complete(t);else{var i=new r;t.loggingStart=Date.now()/1e3,t.activityLogId=r.getActivityLogId(),n=i.createLoggingFunction(t);var a=function(){"hidden"===document.visibilityState&&n("pageExit")};document.addEventListener("visibilitychange",a);e.removers.push(function(){document.removeEventListener("visibilitychange",a)}),t.compleatActivity=!0,this.complete(t)}},i}(e.Task);e.ActivityLogTask=a}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(e){var n=function(){function n(){this.context=new e.NidanContext;var n=localStorage.getItem(this.context.environment.storageKey),i=new RegExp("^([a-z]|[A-Z]|[0-9]){80}$");if(n&&!i.test(n)&&localStorage.removeItem(this.context.environment.storageKey),t.nidan.ns||(t.nidan.ns=function(t){}),t.nidan.pd||(t.nidan.pd=function(t){}),t.nidan.ds||(t.nidan.ds=function(t){}),"string"!=typeof e.domain||""===e.domain)throw new Error("domain required");var r=new e.ActivityLogTask,a=new e.NidanSyncTask,o=new e.AccessLogTask;r.setNext(a),a.setNext(o),r.start(this.context)}return n.getInstance=function(){return e.manager||(e.manager=new n)},n.prototype.getNidanID=function(t){if("function"!=typeof t)throw new Error("callback func require");this.context.completeNidanSync?t(this.context.nidanId):this.context.notifyCallbacksForNidanID.push(t)},n.prototype.getNidanAndDadUID=function(t){var n=this;if("function"!=typeof t)throw new Error("callback func require");if(this.context.completeNidanSync&&this.context.completeDaisySync)t(this.context.nidanId,this.context.daisyId);else if(this.context.notifyCallbacksForNidanAndDadUID.push(t),!this.context.requestedDaisySync){this.context.requestedDaisySync=!0;var i=new e.DadUIDSyncTask,r=new e.WaitTask;i.setNext(r);var a=new e.DadUIDNotifyTask;r.setNext(a),this.getNidanID(function(t){r.start(n.context)});var o=new e.ActivityLogTask;o.setNext(i),o.start(this.context)}},n}();e.NidanIdManager=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){!function(t){t.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}}(t.util||(t.util={}))}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(t){var e=function(){function t(){}return t.getUserAgentClientHintInfo=function(){try{return t.getNavigator().userAgentData.getHighEntropyValues(t.HIGH_ENTROPY_VALUE_KEYS)}catch(t){return null}},t.getNavigator=function(){return navigator},t.HIGH_ENTROPY_VALUE_KEYS=["platform","platformVersion","architecture","model","fullVersionList"],t}(),n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.start=function(t){var n=this;if(t.completeUACH)this.complete(t);else{var i=e.getUserAgentClientHintInfo();i?i.then(function(e){t.uach=e}).catch(function(){t.uach=null}).finally(function(){t.completeUACH=!0,n.complete(t)}):(t.uach=null,t.completeUACH=!0,this.complete(t))}},n}(t.Task);t.UACHTask=n}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.getLatestClickID=function(){var t=localStorage.getItem(n.latestClickIdKey);return t||""},n.prototype.getQueryBrowserID=function(){var t=new URL(location.toString()).searchParams.get(n.browserIdQueryKey);return t||""},n.prototype.getBrowserID=function(){var t=localStorage.getItem(n.browserIdKey);return t||""},n.prototype.start=function(e){var i=this;e.latestClickID=this.getLatestClickID();var r=this.getQueryBrowserID();if(r&&localStorage.setItem(n.browserIdKey,r),e.browserId=this.getBrowserID(),""!==e.currentClickID)if(e.latestClickID!==e.currentClickID){t.hera.cr||(t.hera.cr=function(t){}),t.hera.cr=function(t){null!==t&&""!==t&&(e.browserId=t,localStorage.setItem(n.browserIdKey,t)),localStorage.setItem(n.latestClickIdKey,e.currentClickID),i.complete(e)};var a=document.createElement("script"),o=new URL(n.notifyClickUrl+e.currentClickID);""!==e.browserId&&o.searchParams.append("b",e.browserId),""!==e.nidanId&&o.searchParams.append("n",e.nidanId),null!==e.uach&&o.searchParams.append("u",e.getUACHString()),null!==e.currentClickID&&o.searchParams.append("c",e.currentClickID),""!==e.dadUid&&o.searchParams.append("d",e.dadUid),o.searchParams.set("r",window.location.href),o.searchParams.append("callback","d2c.hera.cr"),a.src=o.toString(),document.head.appendChild(a)}else this.complete(e);else this.complete(e)},n.latestClickIdKey="dad_lst_cid",n.browserIdKey="dad_bid",n.browserIdQueryKey="dad_bid",n.notifyClickUrl="https://meas.hera.d2c.ne.jp/v1/clicks/",n}(e.Task);e.NotifyClickTask=n}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.start=function(e){var n=this;t.nidan.NidanIdManager.getInstance().getNidanAndDadUID(function(t,i){e.nidanId=t||"",e.dadUid=i||"",e.completeIdTask=!0,n.complete(e)})},n}(e.Task);e.NidanTask=n}(t.hera||(t.hera={}))}(d2c||(d2c={})),function(t){!function(e){e.loaded=t.hera.loaded||!1,e.cp=void 0===t.hera.cp||t.hera.cp,e.fetchTimeOut=t.hera.fetchTimeOut||500,e.aspq=t.hera.aspq||[];var n=function(){function n(){var n;if(this.consumptedQueueTasks=!1,this.context=new e.HeraContext,this.fetchTimeOut=e.fetchTimeOut,this.tasks=[],t.hera.cp){var a=new e.NidanTask;this.tasks.push(a),n=a}else{var o=new e.GetDaisyIdTask;this.tasks.push(o),n=o}var c=new e.UACHTask;this.tasks.push(c);var s=new i;this.tasks.push(s),n.setNext(s),c.setNext(s);var d=new e.ActivityLogTask;this.tasks.push(d),s.setNext(d);var u=new e.ClickIDSyncTask;this.tasks.push(u),d.setNext(u);var h=new e.NotifyClickTask;this.tasks.push(h),u.setNext(h);var l=new r;this.tasks.push(l),h.setNext(l),c.start(this.context),n.start(this.context)}return n.prototype.isTasksComplete=function(){return this.tasks.forEach(function(t){if(!t.isComplete)return!1}),!0},n.getInstance=function(){return this._manager||(this._manager=new n)},n.prototype.consumpteQueueTasks=function(){if(!this.consumptedQueueTasks&&this.isTasksComplete()){for(this.consumptedQueueTasks=!0,e.et=n.eventTracking,e.etwc=n.eventTrackingWithCallback,e.addSearchParameter=n.addSearchParameter;e.etq.length>0;){var t=e.etq.shift();if(!t)return;this.sendTracking(t)}for(;e.aspq.length>0;){var i=e.aspq.shift();if(!i)return;this.rewriteAnchor(i)}}},n.eventTracking=function(){n.getInstance().sendTracking(arguments)},n.eventTrackingWithCallback=function(){n.getInstance().sendTrackingWithCallback(arguments)},n.addSearchParameter=function(t){n.getInstance().rewriteAnchor(t)},n.prototype.sendTracking=function(t){var e=Array.from(t);if(this.isValidParameters(e)){var n=e[0],i=e[1],r=e[2]||null,a=this.createBeaconURL(i,n,r),o=document.createElement("img");o.src=a,o.style.height="0px",o.style.width="0px",o.style.display="none",document.body.appendChild(o);var c=document.createElement("script"),s=new XMLHttpRequest;s.onreadystatechange=function(){200===s.status&&0!==s.responseText.length&&(c.innerText=s.responseText,document.body.appendChild(c))};var d=this.createThirdPartyBeaconURL(i,n);s.open("GET",d),s.send()}},n.prototype.isValidParameters=function(t){return!(t.length<2)&&("string"==typeof t[0]&&""!==t[0]&&("string"==typeof t[1]&&""!==t[1]&&(2===t.length||"number"==typeof t[2]&&(t.length,!0))))},n.prototype.createBeaconURL=function(e,i,r){var a=new URL(n.baseUrl+e+"/"+i+"/tag.gif");a.searchParams.set("a",this.context.activityLogId),""!==this.context.dadUid&&a.searchParams.set("d",this.context.dadUid),t.hera.cp&&""!==this.context.nidanId&&a.searchParams.set("n",this.context.nidanId),a.searchParams.set("r",window.location.href),this.context.uach&&a.searchParams.set("u",this.context.getUACHString()),""!==this.context.browserId&&a.searchParams.set("b",this.context.browserId),r&&a.searchParams.set("s",r.toString());var o=new URLSearchParams(window.location.search);return n.COOPERATION_PARAM_LIST.forEach(function(t){var e=o.get(t);e&&""!=e&&a.searchParams.set(t,e)}),a.toString()},n.prototype.createThirdPartyBeaconURL=function(t,e){return new URL("https://cdn.hera.d2c.ne.jp/v1/third-party/"+t+"/"+e+"/measure.js").toString()},n.prototype.sendTrackingWithCallback=function(t){var e=this,n=Array.from(t);if(this.isValidParametersForCallback(n)){var i=n[0],r=n[1],a=new Array;i.forEach(function(t){var n=t[0],i=t[1],r=t[2]||null;a.push(e.sendPromiseTracking(n,i,r))}),Promise.allSettled(a).then(function(t){t.forEach(function(t){}),r()})}},n.prototype.sendPromiseTracking=function(t,e,n){return __awaiter(this,void 0,void 0,function(){var i,r,o;return __generator(this,function(c){switch(c.label){case 0:return(i=new a).eventName=t,i.trackerId=e,r=i,[4,this.sendHeraTrackingPromise(e,t,n)];case 1:return r.heraResult=c.sent(),o=i,[4,this.sendLogicadTrackingPromise(e,t)];case 2:return o.logicadResult=c.sent(),[2,i]}})})},n.prototype.sendHeraTrackingPromise=function(t,e,n){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(a){switch(a.label){case 0:return i=this.createBeaconURL(t,e,n),[4,this.fetchWithTimeout(i,{method:"GET",mode:"cors"},this.fetchTimeOut)];case 1:return(r=a.sent())&&200===r.status?[2,"succeeded"]:[2,"faild"]}})})},n.prototype.sendLogicadTrackingPromise=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,i,r,a;return __generator(this,function(o){switch(o.label){case 0:return n=this.createThirdPartyBeaconURL(t,e),[4,this.fetchWithTimeout(n,{method:"GET",mode:"cors"},this.fetchTimeOut)];case 1:return(i=o.sent())?[4,i.text()]:[2,"faild"];case 2:return r=o.sent(),a=document.createElement("script"),200===i.status?(0!==r.length&&(a.innerText=r,document.body.appendChild(a)),[2,"succeeded"]):[2,"faild"]}})})},n.prototype.isValidParametersForCallback=function(t){var e=this;return!(2!==t.length||!Array.isArray(t[0])||0!==t[0].filter(function(t){return!(Array.isArray(t)&&e.isValidParameters(t))}).length||"function"!=typeof t[1])},n.prototype.fetchWithTimeout=function(t,e,n){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(a){switch(a.label){case 0:i=new AbortController,r=setTimeout(function(){i.abort()},n),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,fetch(t,__assign({signal:i.signal},e))];case 2:return[2,a.sent()];case 3:return a.sent(),[2,null];case 4:return clearTimeout(r),[7];case 5:return[2]}})})},n.prototype.rewriteAnchor=function(t){var e=this;if("string"==typeof t)if("complete"===document.readyState){if(this.context.browserId)for(var i=document.getElementsByClassName(t),r=0;r<i.length;r++){var a=i[r];if(a.getAttribute("href")){var o=new URL(a.href);o.searchParams.set(n.browserIdQueryKey,this.context.browserId),a.setAttribute("href",o.toString())}}}else document.addEventListener("readystatechange",function(){"complete"===document.readyState&&e.rewriteAnchor(t)})},n.baseUrl="https://meas.hera.d2c.ne.jp/v1/events/",n.browserIdQueryKey="dad_bid",n.COOPERATION_PARAM_LIST=["utm_source","utm_medium","utm_campaign","utm_id","utm_term","utm_content"],n}();setTimeout(function(){e.loaded||(e.loaded=!0,n.getInstance())});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(t){t.completeIdTask&&t.completeUACH&&this.complete(t)},e}(e.Task),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(t){this.complete(t),n.getInstance().consumpteQueueTasks()},e}(e.Task),a=function(){return function(){this.eventName="",this.trackerId="",this.heraResult="",this.logicadResult=""}}()}(t.hera||(t.hera={}))}(d2c||(d2c={}));